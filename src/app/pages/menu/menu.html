<div class="container-fluid p-0">
  <header class="main-header bg-primary text-white p-3 shadow-sm">
      <h1 class="h4 mb-0 text-center"> Menu del restaurante {{ restaurantName}}</h1>
  </header>
      <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
          <div class="container">
              <a routerLink="/menu" class="navbar-brand">
                  <span class="app-name fw-bold text-primary">Men√∫ Digital</span>
              </a>
              @if (isOwner) {
                <button class="btn btn-success btn-sm" (click)="addNewProduct()">
                  + Agregar Producto
                </button>
              }
          </div>
      </nav>
  <main class="menu-container container mt-4">

    <section class="categories-nav mb-4 w-100">
      <div class="d-flex flex-row overflow-x-auto pb-2 gap-2 w-100">
        @for (cat of categories; track cat.name) {
          <div class="d-flex flex-column align-items-center flex-fill">
            <button 
            class="btn text-nowrap w-100"
            [class.btn-success]="(currentCategoryId === cat.categoryId && currentIsDiscount === cat.isDiscount)"
            [class.btn-outline-success]="!(currentCategoryId === cat.categoryId && currentIsDiscount === cat.isDiscount)"
            (click) = "selectCategory(cat.categoryId, cat.isDiscount, cat.isHappyHour || false)">
            {{ cat.name }}
            </button>
            @if (isOwner && cat.categoryId !== undefined) {
              <div class="mt-1 d-flex gap-1">
                <button class="btn btn-sm btn-light border text-primary py-0" (click)="editCategory(cat)" title="Editar">
                  <small>Editar</small>
                </button>
                <button class="btn btn-sm btn-light border text-danger py-0" (click)="deleteCategory(cat.categoryId)" title="Eliminar">
                  <small>Eliminar</small>
                </button>
              </div>
            }
          </div>
        }
      </div>
    </section>

      @if (isLoading){
          <div class="spinner-area text-center py-5">
              <app-spinner></app-spinner>
          </div>
      } @else {
      <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4 products-list">
        @for (item of menu; track item.id) {
          <div class="col">
            <app-product-card 
              [product]="item" 
              (viewDetail)="openDetail($event)">
            </app-product-card>

            @if (isOwner) {
              <div class="d-flex justify-content-end gap-2 mt-2 px-2">
                <button class="btn btn-sm btn-outline-primary" (click)="openDetail(item)">Editar</button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteProduct(item.id)">Eliminar</button>
              </div>
            }
          </div>
        } @empty {
          <div class="col-12">
            <p class="alert alert-info text-center">No se encontraron productos.</p>
          </div>
        }
      </div>
    }
  </main>
</div>
@if (selectedProduct) {
  <app-product-detail-modal 
    [product]="selectedProduct!" 
    (close)="closeDetail()">
  </app-product-detail-modal>
}

@if (showCategoryForm) {
  <div class="modal-backdrop fade show"></div>
  <div class="modal d-block show" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <app-categories 
          [categoryIdToEdit]="categoryIdSelected">
        </app-categories>
        <div class="p-3 text-center">
          <button class="btn btn-secondary w-100" (click)="showCategoryForm = false">
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>
}